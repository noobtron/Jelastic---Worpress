{
    "jpsVersion": "0.3",
    "jpsType": "install",
    "application": {
        "id": "Wordpress - 4.6.1",
        "name": "Wordpress - 4.6.1",
        "version": "4.6.1",
        "categories" : [
            "apps/blogs"
        ,"apps/content-management"],
        "logo": "https://download.jelastic.com/public.php?service=files&t=3da2215839f82aa50d3d961271cd1cb9&download",
        "type": "php",
        "homepage": "http://wordpress.org/",
        "description": {
            "text": "WordPress is web software you can use to create a beautiful website or blog. We like to say that WordPress is both free and priceless at the same time."
        },
        "env": {
            "topology": {
                "ha": false,
                "engine": "php7.0",
                "ssl": false,
                "nodes": [
                    {
                        "extip": false,
                        "count": 1,
                        "cloudlets": 16,
                        "nodeType": "nginxphp"
                    },
                    {
                        "nodeType": "mariadb10",
                        "extip": false,
                        "count": 1,
                        "cloudlets": 16
                    }
                ]
            },
            "deployments": [
                {
                    "archive": "https://owncloud.sylvesteri.fi/owncloud/index.php/s/HSqj7WrIKjiymZZ/download",
                    "name": "wordpress-4.6.1.zip",
                    "context": "ROOT"
                }
            ],
            "configs": [
                {
                    "nodeType": "mariadb10",
                    "database": {
                        "name": "wordpress",
                        "user": "wp-db",
                        "dump": "https://owncloud.sylvesteri.fi/owncloud/index.php/s/CZOjjLjXCRuM0ip/download",
                        "patch": "UPDATE wordpress.wp_posts SET guid='${env.url}?p=1' WHERE id='1';UPDATE wordpress.wp_posts SET guid='${env.url}?p=2' WHERE id='2'; UPDATE wordpress.wp_posts SET guid='${env.url}?p=3' WHERE id='3'; UPDATE wordpress.wp_options SET option_value='${env.protocol}://${env.domain}' WHERE option_name='home'; UPDATE wordpress.wp_options SET option_value='${env.protocol}://${env.domain}' WHERE option_name='siteurl'; UPDATE wordpress.wp_options SET option_value='${user.email}' WHERE option_name='admin_email'; UPDATE wordpress.wp_users SET user_email='${user.email}' WHERE user_login='wp-admin';UPDATE wordpress.wp_users SET user_pass=MD5('${user.appPassword}') WHERE user_login='wp-admin';"
                    }
                },
				{
                    "nodeType": "nginxphp",
                    "path": "${SERVER_WEBROOT}/ROOT/wp-config.php",
                    "replacements": [
                        {
                            "pattern": "database_name_here",
                            "replacement": "${nodes.mariadb10.database.name}"
                        },
                        {
                            "pattern": "username_here",
                            "replacement": "${nodes.mariadb10.database.user}"
                        },
                        {
                            "pattern": "password_here",
                            "replacement": "${nodes.mariadb10.database.password}"
                        },
                        {
                            "pattern": "localhost",
                            "replacement": "${nodes.mariadb10.address}"
                        }
                    ]
                },
                {
                    "nodeType": "nginxphp",
                    "path": "/etc/nginx/nginx.conf",
                    "replacements": [
                        {
                            "pattern": "index  index.html index.htm index.php;",
                            "replacement": "index  index.html index.htm index.php;\n            try_files $uri $uri/ /index.php?$args;"
                        }
                    ]
                },
    			{
                    "restartNodes": [
                        {
                            "nodeGroup": "sqldb"
                        }
                    ]
                },
                {
                    "restartNodes": [
                        {
                            "nodeGroup": "cp"
                        }
                    ]
                }
            ]
        },
        "success": {
            "text": "Below you will find your admin panel link, usernames and passwords.</br></br> <table style='font-size:13px; border: none;'><tr><td>Admin panel URL:</td><td style='padding-left: 10px;'><a href='${env.protocol}://${env.domain}/wp-admin/' target='_blank'>${env.protocol}://${env.domain}/wp-admin/</a></td></tr>  <tr><td>Admin name:</td><td style='padding-left: 10px;'>wp-admin</td></tr><tr><td>Password:</td><td style='padding-left: 10px;'>${user.appPassword}</td></tr><tr><td>Database admin name:</td><td style='padding-left: 10px;'>wp-db</td></tr><tr><td>Password:</td><td style='padding-left: 10px;'>${nodes.mariadb10.database.password}</td></tr></table></br>To add custom domain name for your Wordpress installation follow the steps described in our <a href='http://docs.jelastic.com/custom-domains' target='_blank'>documentation</a>"
        }
    }
}
